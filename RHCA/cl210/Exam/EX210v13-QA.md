[TOC]

# 系统信息

![cl210-classroom-architecture](https://github.com/letsencrypt6/RedHat/blob/main/RH/images/cl210-classroom-architecture.png)

# 配置练习环境

##  VMware虚拟机配置

|      |         最小         |     建议     |             原因             |
| :--: | :------------------: | :----------: | :--------------------------: |
| CPU  | >= **14** 个处理器内核 | 直接配置最大 | 内核太少，KVM有2-3个无法启动 |
| MEM  |        不确定        |  **32768**MB   |     内存太小，KVM启动慢      |



# 练习要求

## 1. 操作 UnderCloud 基础架构 - c1

> 在 directory 上的云下列出管理网络子网
> 请填空：**前缀**、**初始八位字节**、**最终八位字节**。 
>
> 例如：  
>
> - [ ] 分配池 **10.10.1.50-10.10.1.80**， CIDR **10.10.1.0/24** 
> - [ ] 前缀：**10.10.1.0** 
> - [ ] 初始十进制：**50** 
> - [ ] 最终十进制：**80**

**[stack@director]**

```bash
*$ source ~/stackrc

*$ openstack subnet list -c Name
+---------------------+
| Name                |
+---------------------+
| external_subnet     |
|`management_subnet`  |
| internal_api_subnet |
| ctlplane-subnet     |
| storage_mgmt_subnet |
| tenant_subnet       |
| storage_subnet      |
+---------------------+

*$ openstack subnet show management_subnet \
     | egrep 'allo|cidr'
| allocation_pools  | 172.24.5.`60`-172.24.5.`99`     |
| cidr              | `172.24.5.0`/24                 |
```



## 2. 操作 OverCloud 基础架构 - c1

> - [ ] 列出在 **controller0** 上与 Open Virtual Network 网桥 **br-int** 相关的接口名称 

**[root@controller0]**

```bash
# rpm -qa | grep switch
# rpm -ql openvswitch | grep bin

# ovs-vsctl --help
# ovs-vsctl list-br

# ovs-vsctl list-ifaces --help

*# ovs-vsctl list-ifaces br-int
o-hm0
ovn-028ad0-0
ovn-8b62a3-0
ovn-cc9fe3-0
```



## 3. 轮转身份认证服务 tokens - c3

> - [ ] 在**director**上轮转 **Fernet** 身份认证服务 **tokens**  

**[stack@director]**

```bash
$ source ~/stackrc

$ openstack workflow list \
    | grep fernet
| c00289f9-612a-4744-b94a-a24d8e89736b | `tripleo.fernet_keys.v1.rotate_fernet_keys` | | f50fbd0341134b97a5a735cca5d6255c | tripleo-common-managed  | container, queue_name=tri...

$ openstack workflow show \
    tripleo.fernet_keys.v1.rotate_fernet_keys \
    | grep -i input
| Input      | `container`, ... |

$ openstack workflow execution create -h
*$ openstack workflow execution create \
    tripleo.fernet_keys.v1.rotate_fernet_keys \
    '{"container": "overcloud"}'
+--------------------+--------------------------------------
| Field              | Value
+--------------------+--------------------------------------
| ID                 |`e0ead7b5-542b-4815-b0ed-aca1753fac1f`
| Workflow ID        | c00289f9-612a-4744-b94a-a24d8e89736b
| Workflow name      | tripleo.fernet_keys.v1.rotate_fernet_keys
| Workflow namespace |
| Description        |
| Task Execution ID  | <none>
| State              |`RUNNING`
| State info         | None
| Created at         | 2019-05-13 20:15:59
| Updated at         | 2019-05-13 20:15:59
+--------------------+--------------------------------------
```

```bash
$ openstack workflow execution show \
    e0ead7b5-542b-4815-b0ed-aca1753fac1f \
    | grep State
| State              |`SUCCESS`|
| State info         | None    |

$ ssh root@controller0 \
    ls -lh /var/lib/config-data/puppet-generated/keystone/etc/keystone/fernet-keys
-rw-------. 1 42425 42425 44 Jun 30 20:10 `0`
-rw-------. 1 42425 42425 44 Jun 30 20:10 `1`
-rw-------. 1 42425 42425 44 Jun 30 20:10 `2`
```



## 4. Inspect a containerized service - c2

> - [ ] 查找 **Redis** 服务 **密码** 

**[root@controller0]**

方法A、

```bash
# docker ps | grep redis
e0c52383f9b8        172.25.249.200:8787/rhosp13/openstack-redis:pcmklatest                 "/bin/bash /usr/lo..."   4 hours ago         Up 4 hours		`redis-bundle-docker-0`

# docker inspect redis-bundle-docker-0
...
           "Binds": [
								...
                "/var/lib/config-data/puppet-generated/redis/:/var/lib/kolla/config_files/src:ro",

*# grep ^requirepass \
  /var/lib/config-data/puppet-generated/redis/etc/redis.conf
requirepass `wuTuATnYuMrzJQGj8KxBb6ZAW`
```

方法2、

```bash
# docker ps | grep redis
99815b74c249        172.25.249.200:8787/rhosp13/openstack-redis:pcmklatest                 "/bin/bash /usr/lo..."   About an hour ago   Up About an hour                                         `redis-bundle-docker-0`

*# docker exec -it redis-bundle-docker-0 bash
*()[root@controller0 /]# grep pass /etc/redis.conf
...输出省略...
requirepass `wuTuATnYuMrzJQGj8KxBb6ZAW`
*()[root@controller0 /]# ps aux | grep redis
*()[root@controller0 /]# redis-cli -h 172.24.1.1 -a wuTuATnYuMrzJQGj8KxBb6ZAW

密码正确
172.24.1.1:6379> info
config_file:/etc/redis.conf
...
密码错误
172.24.1.1:6379> keys *
(error) NOAUTH Authentication required.

*()[root@controller0 /]# <Ctrl-D>
```

```bash
# redis-cli -h 172.24.1.1 -a wuTuATnYuMrzJQGj8KxBb6ZAW
172.24.1.1:6379> keys *
```



## 5. Configure users - c3

> 创建 OpenStack 域 **EX210**，其中包含 
>
> - [ ] **Engineering**
> - [ ] **Production**
>
> 在域 EX210 中创建 OpenStack 组 **Devops**，其中需包含以下用户:
>
> - [ ] **Robert**用户是**Engineering**项目的用户与管理员，email 地址为Robert@lab.example.com
> - [ ] **George**用户是**Engineering**项目的用户，email 地址为George@lab.example.com
> - [ ] **William**用户是**Production**项目的用户与管理员，email 地址为William@lab.example.com
> - [ ] **John**用户是**Production**项目的用户，email 地址为John@lab.example.com
>
> 所有用户账户的密码都是**redhat** 

<div style="background: #dbfaf4; padding: 12px; line-height: 24px; margin-bottom: 24px;">
<dt style="background: #1abc9c; padding: 6px 12px; font-weight: bold; display: block; color: #fff; margin: -12px; margin-bottom: -12px; margin-bottom: 12px;" >Hint - 提示</dt>
<li>考试时，默认只能使用命令行
<li>开启网页面板，需配置 <b>keystone</b> 和 <b>horizon</b>，重启容器生效
</div>
```bash
# 准备练习环境
# 培训环境，需执行：director.sh/disable_horizon
# [stack@director]$

ssh root@controller0 "
    sed -i '/domain_specific_drivers_enabled/s/=.*/=False/' /var/lib/config-data/puppet-generated/keystone/etc/keystone/keystone.conf
    docker restart keystone
    sed -i '/^OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT/s/=.*/= False/' /var/lib/config-data/puppet-generated/horizon/etc/openstack-dashboard/local_settings
    docker restart horizon
    "
```



**[root@controller0] - firefox**

```bash
*# vim /var/lib/config-data/puppet-generated/keystone/etc/keystone/keystone.conf
```
```ini
domain_specific_drivers_enabled=True
...输出省略...
```
```bash
*# docker restart keystone

*# vim /var/lib/config-data/puppet-generated/horizon/etc/openstack-dashboard/local_settings
```
```ini
OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True
...输出省略...
```
```bash
*# docker restart horizon
```



**[stack@director]**

```bash
*$ source overcloudrc

# 1. 创建 domain
*$ openstack domain create EX210

$ openstack domain list
+----------------------------------+------------+---------+--------------------+
| ID                               | Name       | Enabled | Description        |
+----------------------------------+------------+---------+--------------------+
| 00b247596f844b23b46e2df7f755654b |`EX210`     | True    |                    |
| 0f60d2e3835f48d2bdd3cc524855c4cd | heat_stack | True    |                    |
| 8dd2d316acc74f54b890bae519ea75b9 | Example    | True    | Example Domain     |
| default                          | Default    | True    | The default domain |
+----------------------------------+------------+---------+--------------------+

# 2. 创建项目
*$ openstack project create --domain EX210 Engineering
*$ openstack project create --domain EX210 Production

$ openstack project list --domain EX210
+----------------------------------+-------------+
| ID                               | Name        |
+----------------------------------+-------------+
| f4b51873934b4022b32babe1564e02fb |`Engineering`|
| ed11f427f93d472c8e78a19ec6821a99 |`Production` |
+----------------------------------+-------------+

# 创建用户
*$ openstack user create \
    --domain EX210 \
    --project Engineering --project-domain EX210 \
    --email Robert@lab.example.com \
    --password redhat \
    Robert

*$ openstack user create \
    --domain EX210 \
    --project Engineering --project-domain EX210 \
    --email George@lab.example.com \
    --password redhat \
    George

*$ openstack user create \
    --domain EX210 \
    --project Production --project-domain EX210 \
    --email William@lab.example.com \
    --password redhat \
    William

*$ openstack user create \
    --domain EX210 \
    --project Production --project-domain EX210 \
    --email John@lab.example.com \
    --password redhat \
    John

$ openstack user list --domain EX210
+----------------------------------+---------+
| ID                               | Name    |
+----------------------------------+---------+
| 3912ff1af0284832bc3323ecdf7e4a90 |`Robert` |
| 55060c025b434cd681c98cf8f4161c5b |`William`|
| a0673af77ac54e7faad1a254c07e8887 |`John`   |
| d398f2614fc64ad3ac61d8abdf88637e |`George` |
+----------------------------------+---------+

# 3 分配角色
$ openstack role list
+----------------------------------+-----------------+
| ID                               | Name            |
+----------------------------------+-----------------+
| 0aa9cdf501324d88b5a58c7773dec328 | swiftoperator   |
| 68625e59d10e42c5a91c7e84eea8490a | heat_stack_user |
| 6fd3ce42a3b645d19e406571b1c0df46 | ResellerAdmin   |
| 9fc98f8d769c4ad08a7ffeae83a19029 |`admin`          |
| 9fe2ff9ee4384b1894a90878d3e92bab |`_member_`       |
+----------------------------------+-----------------+

*$ openstack role add \
    --user Robert --user-domain EX210 \
    --project Engineering --project-domain EX210 \
    admin
*$ openstack role add \
    --user Robert --user-domain EX210 \
    --project Engineering --project-domain EX210 \
    _member_

*$ openstack role add \
    --user George --user-domain EX210 \
    --project Engineering --project-domain EX210 \
    _member_

*$ openstack role add \
    --user William --user-domain EX210 \
    --project Production --project-domain EX210 \
    admin
*$ openstack role add \
    --user William --user-domain EX210 \
    --project Production --project-domain EX210 \
    _member_

*$ openstack role add \
    --user John --user-domain EX210 \
    --project Production --project-domain EX210 \
    _member_

$ openstack role assignment list \
    --names \
    --user-domain EX210 \
    --project Production --project-domain EX210
+----------+---------------+-------+------------------+--------+-----------+
| Role     | User          | Group | Project          | Domain | Inherited |
+----------+---------------+-------+------------------+--------+-----------+
|`admin`   | William@EX210 |       | Production@EX210 |        | False     |
|`_member_`| William@EX210 |       | Production@EX210 |        | False     |
|`_member_`| John@EX210    |       | Production@EX210 |        | False     |
+----------+---------------+-------+------------------+--------+-----------+

$ openstack role assignment list --names \
    --user-domain EX210 \
    --project Engineering --project-domain EX210
+----------+--------------+-------+-------------------+--------+-----------+
| Role     | User         | Group | Project           | Domain | Inherited |
+----------+--------------+-------+-------------------+--------+-----------+
|`admin`   | Robert@EX210 |       | Engineering@EX210 |        | False     |
|`_member_`| Robert@EX210 |       | Engineering@EX210 |        | False     |
|`_member_`| George@EX210 |       | Engineering@EX210 |        | False     |
+----------+--------------+-------+-------------------+--------+-----------+

# 4. 创建组 Devops
*$ openstack group create --domain EX210 Devops

$ openstack group list --domain EX210
+----------------------------------+--------+
| ID                               | Name   |
+----------------------------------+--------+
| 2dae8b74fea740b99a82f214d545fcb5 |`Devops`|
+----------------------------------+--------+

# 5 用户添加到组 Devops 中
*$ openstack group add user \
    --group-domain EX210 \
    --user-domain EX210 Devops \
    Robert George William John

$ for OS_USER in Robert George William John; do
	  openstack group contains user --group-domain EX210 --user-domain EX210 Devops ${OS_USER}
	done
`Robert` in group `Devops`
`George` in group `Devops`
`William` in group `Devops`
`John` in group `Devops`
```



## 6. 配置资源 - c7

> 创建部署服务器实例所需的资源。 
>
> 使用以下属性创建 **public** 虚拟机风格：  
>
> - [ ] Flavor 名称： **m1.petite** 
>   - [ ] 虚拟机内存：**1024MB** 
>
>   - [ ] 处理器：**1** 
>
>   - [ ] 根磁盘：**10GB**  
>
>
> 将位于 http://materials/osp-small.qcow2 的镜像添加到 Glance 镜像服务。  
>
> - [ ] 此镜像应命名为 **web** 
>
>   - [ ] 镜像格式为 **QCOW2** 
>
>   - [ ] 镜像应该可供 **everyone**  
>
> 为项目**Engineering** 创建以下安全组：  
>
> - [ ] 名为 **ssh** 的组应允许从互联网访问端口 **22** 和 **ICMP** ping 
>
> - [ ] 名为 **web** 的组应允许从互联网访问端口 **80**  
>
> 在工程项目中创建名为 **webkey** 的密钥对。
> 此密钥对应存储在 director.lab.example.com 上的文件 **/home/stack/webkey.pem** 中

**[stack@director]**

```bash
*$ source ~/overcloudrc

# 创建flavor
*$ openstack flavor create \
    --vcpus 1 \
    --ram 1024 \
    --disk 10 \
    --public \
    m1.petite

$ openstack flavor show m1.petite
+----------------------------+-----------------------------
| Field                      | Value
+----------------------------+------------------------------
| OS-FLV-DISABLED:disabled   | False
| OS-FLV-EXT-DATA:ephemeral  | 0
| access_project_ids         | None
| disk                       |`10`
| id                         | 6a68bc7b-661c-42c0-bab7-...
| name                       | m1.petite
| os-flavor-access:is_public |`True`
| properties                 |
| ram                        |`1024`
| rxtx_factor                | 1.0
| swap                       |
| vcpus                      |`1`
+----------------------------+------------------------------

# 创建image
*$ wget http://materials/osp-small.qcow2
...
yyy-mm-dd hh:mm:ss (299 MB/s) - 已保存 “osp-small.qcow2” ...

*$ openstack image create \
    --disk-format qcow2 \
    --file ~/osp-small.qcow2 \
    --public \
    web

$ openstack image list
+--------------------------------------+-----------------+--------+
| ID                                   | Name            | Status |
+--------------------------------------+-----------------+--------+
| ec9473de-4048-4ebb-b08a-a9be619477ac | octavia-amphora | active |
| 6b0128a9-4481-4ceb-b34e-ffe92e0dcfdd | rhel7           | active |
| 5f7f8208-33b5-4f17-8297-588f938182c0 | rhel7-db        | active |
| 14b7e8b2-7c6d-4bcf-b159-1e4e7582107c | rhel7-web       | active |
| 29bf0ee9-3c74-4beb-9e6e-41440ca89fa8 |`web`            | active |
+--------------------------------------+-----------------+--------+

# 准备Robert凭据文件
*$ cp ~/overcloudrc ~/robertrc
*$ vim ~/robertrc
```
```ini
#export OS_USERNAME=admin
export OS_USERNAME=Robert
#export OS_USER_DOMAIN_NAME=Default
export OS_USER_DOMAIN_NAME=EX210
export OS_PASSWORD=redhat
#export OS_PROJECT_DOMAIN_NAME=Default
export OS_PROJECT_DOMAIN NAME=EX210
#export OS_PROJECT_NAME=admin
export OS_PROJECT_NAME=Engineering
...
```
```bash
# 切换变量
*$ source ~/robertrc

# 创建安全组
*$ openstack security group create ssh
*$ openstack security group rule create \
    --dst-port 22 ssh
*$ openstack security group rule create \
    --protocol icmp ssh

*$ openstack security group create web
*$ openstack security group rule create \
    --dst-port 80 web

$ openstack security group list --project Engineering
$ openstack security group rule list ssh
$ openstack security group rule list web

# 创建keypair
*$ openstack keypair create webkey \
    > /home/stack/webkey.pem
$ openstack keypair list

-如果创建时写错了，需删除后再创建
$ openstack keypair delete webkey \
    && openstack keypair create webkey \
      > /home/stack/webkey.pem

:<<EOK
$ ssh -i webkey.pem root@IP
...
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: `UNPROTECTED` PRIVATE KEY FILE!        @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions `0664` for 'webkey.pem' are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
Load key "webkey.pem": `bad permissions`
Permission denied (publickey,gssapi-keyex,gssapi-with-mic).
EOK
*$ chmod 600 /home/stack/webkey.pem
```



## 7. 配置网络 - c6

> 根据以下要求为 Engineering 项目配置网络:
>
> 网络名称:**engnet** 
>- [ ] 子网名称:**engsubnet** 
> - [ ] 网络地址:**192.168.101.0/24** 
> - [ ] 使用 dhcp: **yes**
> 
> 网络名称:**public** 
>- [ ] Provider网络类型:**flat** 
> - [ ] ML2中定义的物理网络名称:**datacentre** 
> - [ ] 该网络为外部网络: **yes**
>   - [ ] 子网名称:**external** 
>   - [ ] 网络地址:**172.25.250.0/24** ，网关: **172.25.250.254** 
>   - [ ] 分配的地址池: **172.25.250.101**-**172.25.250.109** 
>   - [ ] 使用 dhcp: **no**
> 
> 网络名称: **storagenet**
>- [ ] Provider网络类型:**vlan** 
> - [ ] Segmentation ID: **30**
> - [ ] Physical network name that is defined in ML2: **storage** 
> - [ ] ML2中定义的物理网络名称:**storage** 
>   - [ ] 子网名称:**storagesubnet** 
>   - [ ] 网络地址:**172.24.3.0/24** 
>   - [ ] 分配的地址池:**172.24.3.200**-**172.24.3.220**，网关**172.24.3.1** 
>   - [ ] 使用dhcp: **yes**
> 
> 网络 **engnet** 和 **public** 连接到路由器 **ex210-router**，以便此项目中的实例可以访问公网。（注意：有关用于网络网关和其他网络设置的适当值的信息，可以在用于部署云之上的模板目录中找到。) 
>网络存储网络未连接到 ex210 路由器路由器。

```bash
# 准备练习环境
# 培训环境，需执行：director.sh/config_network
# [stack@director]$

source overcloudrc

for i in $(openstack network list -f yaml | awk '/Subnets/ {print $2}' | grep -v e0db6f1e-70be-4360-8210-0435a47e3a88); do
  openstack subnet delete $i
done

openstack network delete \
  production-network1 finance-network1 \
  provider-datacentre provider-storage
```



**[stack@director]**

```bash
$ source ~/robertrc

# 创建 engnet 网络和 engsubnet 子网
*$ openstack network create engnet

*$ openstack subnet create \
    --dhcp \
    --subnet-range 192.168.101.0/24 \
    --network engnet \
    engsubnet

# 创建 public 网络和 external 子网
*$ grep 172.25.250 /home/stack/templates/classroom-environment/32-network-environment.yaml
  ExternalNetCidr: '172.25.250.0/24'
  ExternalAllocationPools: [{'start': '172.25.250.60', 'end': '172.25.250.99'}]
  ExternalInterfaceDefaultRoute: '172.25.250.254'
  DnsServers: ['172.25.250.254','8.8.8.8']

# 培训环境，直接配置报错；先准备练习环境
*$ openstack network create \
    --external \
    --provider-network-type flat \
    --provider-physical-network datacentre \
    public

*$ openstack subnet create \
    --no-dhcp \
    --subnet-range 172.25.250.0/24 \
    --allocation-pool start=172.25.250.101,end=172.25.250.109 \
    --gateway 172.25.250.254 \
    --network public \
    external
```
**[root@controller]**
```bash
创建 storagenet 网络和 storagesubnet 子网
# grep storage /var/lib/config-data/puppet-generated/neutron/etc/neutron/plugins/ml2/ml2_conf.ini
network_vlan_ranges=datacentre:1:1000,vlanprovider1:101:104,vlanprovider2:101:104,storage:`30:30`
```
**[stack@director]**

```bash
*$ openstack network create \
    --provider-network-type vlan \
    --provider-physical-network storage \
    --provider-segment 30 \
    storagenet

*$ openstack subnet create \
    --dhcp \
    --subnet-range 172.24.3.0/24 \
    --allocation-pool start=172.24.3.200,end=172.24.3.220 \
    --gateway 172.24.3.1 \
    --network storagenet \
    storagesubnet

# 创建路由器ex210-router并连接两个网络
*$ openstack router create ex210-router

*$ openstack router set \
    --external-gateway public \
    ex210-router

*$ openstack router \
    add subnet ex210-router \
    engsubnet
```



## 8. 使用 cloud-init 运行实例 - c4

> 根据以下要求运行名为**webserver**的实例: 
>
> - [ ] 在**Engineering**项目中运行实例 
>- [ ] 实例使用名为**web**的镜像 
> - [ ] 实例使用名为**m1.petite**的flavor 
> - [ ] 实例连接到**engnet**网络上 
> - [ ]  实例使用**ssh**安全组与**web**安全组 
> - [ ]  实例使用名为**webkey**的密钥 
> 
> 在 director.lab.example.com 上使用云初始化数据文件 **/home/stack/cloud-init.sh** 启动实例。该脚本用于安装用于下载 swift 对象文件的 openstack 客户端。
>
> 将子网 172.25.250.0/24 中的浮动 IP 关联到实例 Web 服务器。浮动 IP 应该可以使用 webkey 密钥对和用户云用户从其他主机通过 SSH 访问。 浮动 IP 也应该可以通过 http 访问。
>
> instance 的用户根的密码是 **redhat**

```bash
# 准备练习环境
# 培训环境，需执行：director.sh/cloud_init
# [stack@director]$

cat > cloud-init.sh <<EOF
#!/bin/bash
HOSTNAME=\$(hostname -s)
yum -y install httpd
yum -y install python2-openstackclient
echo Hello OpenStack >/var/www/html/index.html
systemctl enable --now httpd
EOF
```



**[stack@director ~]**

```bash
*$ source ~/robertrc

# 培训环境，需执行：director.sh/cloud_init
# 创建实例
*$ openstack server create \
    --flavor m1.petite \
    --image web \
    --nic net-id=engnet \
    --security-group ssh \
    --security-group web \
    --key-name webkey \
    --user-data ~/cloud-init.sh \
    --wait \
    webserver

$ openstack server list
+--------------------------------------+-----------+--------+----------------------+-------+-----------+
| ID                                   | Name      | Status | Networks             | Image | Flavor    |
+--------------------------------------+-----------+--------+----------------------+-------+-----------+
| 019dfb33-6a18-408d-8b97-96f206af517f |`webserver`| ACTIVE | engnet=192.168.101.5 | web   | m1.petite |
+--------------------------------------+-----------+--------+----------------------+-------+-----------+

# 分配浮动IP
*$ openstack floating ip create public \
    | grep floating_ip_address
| floating_ip_address | `172.25.250.102` |

*$ openstack server add floating ip \
    webserver 172.25.250.102

$ openstack server list
+--------------------------------------+-----------+--------+--------------------------------------+-------+-----------+
| ID                                   | Name      | Status | Networks                             | Image | Flavor    |
+--------------------------------------+-----------+--------+--------------------------------------+-------+-----------+
| 019dfb33-6a18-408d-8b97-96f206af517f | webserver | ACTIVE | engnet=192.168.101.5,`172.25.250.102`| web   | m1.petite |
+--------------------------------------+-----------+--------+--------------------------------------+-------+-----------+
```

```bash
$ ssh -i webkey root@172.25.250.102
Please login as the user "cloud-user" rather than the user "root".

$ ssh -i webkey.pem \
    cloud-user@172.25.250.102 \
    'hostname -s; echo $HOSTNAME'
`webserver`
`webserver`

$ curl 172.25.250.102
`Hello OpenStack`
```



## 9. 创建块存储卷 - c5

> - [ ] 在 **Engineering** 项目中创建名为 **storage**，大小为 **2GB** 的块存储卷

**[stack@director ~]**

```bash
*$ source ~/robertrc

*$ openstack volume create --size 2 sotorage
```

```bash
$ openstack volume list
+--------------------------------------+---------+-----------+------+-------------+
| ID                                   | Name    | Status    | Size | Attached to |
+--------------------------------------+---------+-----------+------+-------------+
| 5aa17a0b-0233-4044-a472-168e9c911266 |`storage`|`available`| `2`  |             |
+--------------------------------------+---------+-----------+------+-------------+
```



## 10. 附加块存储 - c5

> - [ ] 附加名为 **storage** 的块存储卷至 **webserver** 实例上作为 **/dev/vdb**

**[stack@director ~]**

```bash
*$ source ~/robertrc

*$ openstack server add volume \
    webserver storage
```

```bash
$ openstack volume list
+--------------------------------------+---------+--------+------+------------------------------------+
| ID                                   | Name    | Status | Size | Attached to                        |
+--------------------------------------+---------+--------+------+------------------------------------+
| 8b23022e-8e6f-4747-85cc-0404fb598e68 |`storage`|`in-use`|   2  | Attached to`webserver`on`/dev/vdb` |
+--------------------------------------+---------+--------+------+------------------------------------+

$ openstack server list
$ ssh -i webkey.pem \
    cloud-user@172.25.250.102 \
    lsblk
NAME			MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
vda				253:0    0  10G  0 disk
└─vda1	 253:1    0  10G  0 part /
`vdb`			253:16   0  `2G` 0 disk
```



## 11. 创建存储卷快照 - c5

> - [ ] 在 **Engineering** 项目中为 **storage** 块存储卷创建名为 **strgsnap** 的快照

**[stack@director ~]**

```bash
*$ source ~/robertrc

*$ openstack volume snapshot create \
    --volume storage \
    strgsnap \
    --force
```

```bash
$ openstack volume snapshot list
+--------------------------------------+----------+-------------+-----------+------+
| ID                                   | Name     | Description | Status    | Size |
+--------------------------------------+----------+-------------+-----------+------+
| c76afa10-ca55-4afb-9179-5e9d311007fc |`strgsnap`| None        |`available`| `2`  |
+--------------------------------------+----------+-------------+-----------+------+
```



## 12. 创建 Heat stack - c8

> 使用命令行界面在项目中创建 Heat 模板 **Engineering** Heat 模板将被破坏，您需要修复任何错误才能成功启动实例。对 Heat template 执行以下操作：
>
> - [ ] 改正模板错误使其成功运行
>- [ ] 在实例中创建名为 **stackgroup** 的UNIX组 
> 
> 模板配置完成后，创建环境文件，并使用以下参数对 Heat 堆栈进行初始化：
> 
>- [ ] Stack 名称: **HeatStack** 
> - [ ] Heat 模板：在 director.lab.example.com 上使用**/home/stack/materials/web_server.yaml**
>- [ ] 项目/租户: **Engineering** 
> - [ ] Public 网络: **public** 
> - [ ] Private 网络: **engnet** 
> - [ ] Private 子网: **engsubnet** 
> - [ ] Key 名称: **webkey** 
> - [ ] Flavor: **m1.petite** 
> - [ ] Image: **web** 

```bash
# 准备练习环境
# 培训环境，需执行：director.sh/heat_stack
# [stack@director]$

sshpass -p redhat ssh root@localhost "
    mkdir /home/stack/materials/
    wget http://materials/heat/production-app1.yaml -O /home/stack/materials/web_server.yaml
    sed -i -e '13s/key_name/key_nam/' -e '19,20s/ d/d/' /home/stack/materials/web_server.yaml
    "
```



**[stack@director ~]**

```bash
*$ source ~/robertrc

*$ cp /home/stack/materials/web_server.yaml .

*$ vim web_server.yaml
```
```yaml
...
#4 parameters:
...
#13 key_nam: 与54行做个对比
  key_name:
...
#19default: default
#20description: flavor used by the server
    default: default
    description: flavor used by the server
...
#48   web_server:
#49     type: OS::Nova::Server
#50     properties:
...
#54       key_name: { get_param: key_name }
...
#61       template: |
            #!/bin/bash
            groupadd stackgroup
...
```
```bash
$ cp web_server.yaml web_env.yaml
*$ vim web_env.yaml
```

```yaml
parameters:
  image_name: web
  key_name: webkey
  instance_flavor: m1.petite
  public_net: public
  private_net: engnet
  private_subnet: engsubnet
```

```bash
# 测试并创建stack
*$ openstack stack create \
    -e web_env.yaml \
    --template web_server.yaml \
    --dry-run HeatStack

*$ openstack stack create \
    -e web_env.yaml \
    --template web_server.yaml \
    --wait HeatStack
...
yyyy-mm-dd HH:MM:ssZ [HeatStack]: CREATE_COMPLETE  Stack CREATE completed successfully
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| id                  | 3cea0367-7f7e-4a0d-aeb2-7d06087bd0b4 |
| stack_name          | HeatStack                            |
| description         | launching a custom web server        |
| creation_time       | yyyy-mm-ddTHH:MM:ssZ                 |
| updated_time        | None                                 |
| stack_status        | `CREATE_COMPLETE`                    |
| stack_status_reason | Stack CREATE completed successfully  |
+---------------------+--------------------------------------+
```

```bash
$ openstack floating ip create public \
    | grep floating_ip_address
| floating_ip_address | `172.25.250.104` |

$ openstack server add floating ip \
    production-server 172.25.250.104

$ openstack server list
+--------------------------------------+-------------------+--------+---------------------------------------+-------+-----------+
| ID                                   | Name              | Status | Networks                              | Image | Flavor    |
+--------------------------------------+-------------------+--------+---------------------------------------+-------+-----------+
| 18b69a62-1d0e-4a47-89d7-b06f51ea18d2 |`production-server`| ACTIVE | engnet=192.168.101.10,`172.25.250.104`| web   | m1.petite |
| ec4fd064-4c4f-49ec-ad0c-5229e0049022 | webserver         | ACTIVE | engnet=192.168.101.5, 172.25.250.102  | web   | m1.petite |
+--------------------------------------+-------------------+--------+---------------------------------------+-------+-----------+

$ ssh -i webkey.pem \
    cloud-user@172.25.250.104 \
    grep stackgroup /etc/group
`stackgroup:x:1002:`
```



## 13. 自定义已存在的镜像并运行 VM - c4

> 修改镜像文件 http://materials/osp-small.qcow2 满足以下条件: 
>
> - [ ] 安装**httpd**软件包，并设置为**开机自启动** 
>- [ ] **/var/www/html**目录中包含**index.html**文件，内容为**Klaatu barada nikto** 
> - [ ] 镜像中包含不使用密码的名为**sheila**的用户 
> 
> 上传该镜像至Glance服务中，命名为**web-server**，并满足以下条件: 
>- [ ] 最小内存使用**1024MiB** 
> - [ ] 最小磁盘大小**10GB**
> 
> 创建名为 **m1.web** 的风格，该风格对应于上传图像时指定的资源限制
>
> 上传映像后，在 **Engineering** 项目中启动一个名为 **custom-web-server** 的实例，该实例使用风格 **m1.web**，并将子网 **172.25.250.0/24** 中的浮动 IP 关联到实例
> 
> 实例启动后可通过浮动IP访问Web页面的内容，并看到短语 **Klaatu barada nikto**
> 
> - [ ] 可通过名为**ex210.pem**的PEM密钥ssh连接进入实例 
> - [ ] 该密钥保存在 director 上的**/home/stack/ex210.pem**中

**[stack@director ~]**

```bash
*$ source ~/robertrc

下载-A
*$ wget http://materials/osp-small.qcow2
#\ -O osp-small.qcow2
下载-B
*$curl http://materials/osp-small.qcow2 -o osp-small1.qcow2

*$ yum provides guestfish
*$ sudo yum -y install libguestfs-tools-c

方法A: guestfish
-$ export LIBGUESTFS_BACKEND=direct
$ man guestfish
*$ guestfish -i --network -a osp-small.qcow2
><fs> <Tab><Tab>
><fs> help command
><fs> help write
><fs> help selinux_relabel
><fs> command "yum install -y httpd"
><fs> command "systemctl enable httpd"
><fs> write /var/www/html/index.html "Klaatu barada nikto"
><fs> command "useradd sheila"
><fs> selinux-relabel /etc/selinux/targeted/contexts/files/file_contexts / 
><fs> exit

方法B: virt-customize
$ virt-customize --help
*$ virt-customize -a osp-small.qcow2 \
    --install httpd \
    --run-command 'systemctl enable httpd' \
    --write /var/www/html/index.html:"Klaatu barada nikto" \
    --run-command 'useradd sheila' \
    --selinux-relabel

# 准备flavor image keypair
*$ openstack flavor create \
    --vcpus 1 \
    --ram 1024 \
    --disk 10 \
    m1.web

*$ openstack image create \
    --disk-format qcow2 \
    --min-disk 10 \
    --min-ram 1024 \
    --file osp-small.qcow2 \
    web-server

*$ openstack keypair create ex210 \
    > /home/stack/ex210.pem
*$ chmod 600 /home/stack/ex210.pem

# 创建实例并分配浮动IP
*$ openstack server create \
    --flavor m1.web \
    --image web-server \
    --nic net-id=engnet \
    --security-group ssh --security-group web \
    --key-name ex210 \
    --wait \
    custom-web-server

*$ openstack floating ip create public \
    | grep floating_ip_address
| floating_ip_address |`172.25.250.107`|

*$ openstack server add floating ip \
    custom-web-server 172.25.250.107
```

```bash
$ curl 172.25.250.107
`Klaatu barada nikto`

$ ssh -i ex210.pem \
    cloud-user@172.25.250.107 \
    id sheila
```



## 14. 启用消息队列跟踪 - c2

> 在 controller0 上配置 **RabbitMQ** 消息队列 
>
> - [ ] 创建 **ash** 用户，密码为 **redhat**，该用户可创建、操作与查询RabbitMQ **queues**与**exchanges**
>- [ ] 启用 RabbitMQ 跟踪

**[root@controller0 ~]**

```bash
# docker ps | grep rabbit
d486bf8b2223	172.25.249.200:8787/rhosp13/openstack-rabbitmq:pcmklatest	"/bin/bash /usr/lo..."   19 hours ago	Up 19 hours	`rabbitmq-bundle-docker-0`

*# docker exec -it rabbitmq-bundle-docker-0 bash
()[root@controller0 /]# rabbitmqctl --help
rabbitmqctl [-n <node>] [-t <timeout>] [-q] <command> [<command options>]
...
Commands:
    add_user <username> <password>
    set_permissions [-p <vhost>] <user> <conf> <write> <read>
    set_user_tags <username> <tag> ...
    list_users
    trace_on [-p <vhost>]
    
*()[root@controller0 /]# rabbitmqctl add_user ash redhat
Creating user "ash"

()[root@controller0 /]# rabbitmqctl list_permissions
Listing permissions in vhost "/"
guest	.*	.*	.*

*()[root@controller0 /]# rabbitmqctl set_permissions ash ".*" ".*" ".*"
Setting permissions for user "ash" in vhost "/"

()[root@controller0 /]# rabbitmqctl list_user_permissions ash
Listing permissions for user "ash"
/	.*	.*	.*

*()[root@controller0 /]# rabbitmqctl set_user_tags ash administrator
Setting tags for user "ash" to [administrator]

()[root@controller0 /]# rabbitmqctl list_users
Listing users
`ash	[administrator]`
guest	[administrator]

*()[root@controller0 /]# rabbitmqctl trace_on
Starting tracing for vhost "/"
*()[root@controller0 /]# rabbitmqctl report | grep trace.*vhost
          {trace_vhosts,[<<"/">>]},		# 注意`/`
          
()[root@controller0 /]# <Ctrl-D>
```



## 15. 创建对象存储容器 - c5

> 在项目 **Engineering** 中创建一个名为 **warehouse** 的 Swift 容器，**Robert** 可以使用它来存储文件
>
> - [ ] 将 http://materials/hosts 的副本放入容器中
>
> - [ ] 新对象应与原始对象具有相同的文件名
>
> - [ ] 将 **hosts** 下载到 **/home/cloud-user** 在 **webserver** 实例上

**[stack@director]**

```bash
*$ source ~/robertrc

*$ wget http://materials/hosts
...
yyyy-mm-dd HH:MM:ss (420 MB/s) - 已保存 “hosts” [1449/1449])

*$ openstack container create warehouse

*$ openstack object create warehouse hosts

# 将Robert凭据拷贝到webserver，并使用该凭据下载object
$ openstack server list
+--------------------------------------+-------------------+--------+---------------------------------------+------------+-----------+
| ID                                   | Name              | Status | Networks                              | Image      | Flavor    |
+--------------------------------------+-------------------+--------+---------------------------------------+------------+-----------+
| ec71af96-a60f-4b90-8199-ac6305757950 | custom-web-server | ACTIVE | engnet=192.168.101.9, 172.25.250.107  | web-server | m1.web    |
| ee95ce64-d4b9-4587-b029-b5e16b463792 | production-server | ACTIVE | engnet=192.168.101.10, 172.25.250.104 | web        | m1.petite |
| e6a641dd-5e37-4106-bba0-b7b035f97c59 |`webserver`        | ACTIVE | engnet=192.168.101.5,`172.25.250.102` | web        | m1.petite |
+--------------------------------------+-------------------+--------+---------------------------------------+------------+-----------+

*$ scp -i webkey.pem \
    robertrc cloud-user@172.25.250.102:
robertrc															100%  897     1.7MB/s   00:00

$ ssh -i webkey.pem \
    cloud-user@172.25.250.102
```

**[cloud-user@webserver]**

```bash
:<<EOR
Missing value auth-url required for auth plugin `password`
EOR
*$ source ~/robertrc

*$ openstack object save warehouse hosts

$ ls
`hosts`  robertrc

$ <Ctrl-D>
```



## 16. 查看元数据的网络命名空间 - c6

> - [ ] 在 **compute0 **上查看与 **engnet** 网络相关的元数据代理网络 **命名空间** 

**[stack@director]**

```bash
# 如果 compute0 无 instance，需执行
# 考试时，会有4个 instance
$ openstack hypervisor list
+----+-----------------------------------+-----------------+-------------+-------+
| ID | Hypervisor Hostname               | Hypervisor Type | Host IP     | State |
+----+-----------------------------------+-----------------+-------------+-------+
|  1 | compute1.overcloud.example.com    | QEMU            | 172.24.1.12 | up    |
|  2 | computehci0.overcloud.example.com | QEMU            | 172.24.1.6  | up    |
|  3 |`compute0.overcloud.example.com`   | QEMU            | 172.24.1.2  | up    |
+----+-----------------------------------+-----------------+-------------+-------+

$ openstack server list \
    --host compute0.overcloud.example.com
$ openstack server list
$ openstack server migrate \
    --live compute0.overcloud.example.com \
    custom-web-server
```

```bash
*$ ssh root@compute0 \
    ip netns show
`ovnmeta-85f9f08d-8a62-47d6-9bf4-b00dca727b2b` (id: 0)
```



## 17. 配置共享文件系统 - c5

> 
> 根据以下要求在 Engineering 项目中配置共享文件系统: 
>
> - [x] 共享的名称为 **Engineering_share**
> - [x] 共享使用 **cephfstype** 共享类型，driver_handles_share_servers 设置为**false**
> - [x] 共享使用 **cephfs** 协议 
> - [x] 共享大小为 **1GiB** 
> - [ ] 共享允许 **cloud-user** 用户使用 cephx 认证机制 **读** 和 **写** 访问

**[root@controller0]**

```bash
# 验证manila状态
# docker ps --format "{{.Names}}\t{{.Status}}" \
  | grep manila
openstack-manila-share-docker-0	`Up` 2 hours
manila_api											`Up` 2 hours
manila_scheduler								`Up` 2 hours (`healthy`)
```



**[stack@director]**

```bash
# 配置 manila 共享
*$ source ~/robertrc

$ manila help
    type-create         Create a new share type (Admin only).
    create              Creates a new share (NFS, CIFS, CephFS, GlusterFS, HDFS or MAPRFS).
    access-allow        Allow access to the share.
    access-list         Show access list for share.

$ manila help type-create
...
Positional arguments:
  <name>                Name of the new share type.
  <spec_driver_handles_share_servers>
                        Required extra specification. Valid values are 'true'/'1' and 'false'/'0'.

*1$ manila type-create cephfstype false
+----------------------+--------------------------------------+
| Property             | Value                                |
+----------------------+--------------------------------------+
| required_extra_specs | driver_handles_share_servers : `False` |
| Name                 | `cephfstype`                           |
| Visibility           | public                               |
| is_default           | -                                    |
| ID                   | baf0290c-b95f-435a-950a-65b75cfd110f |
| optional_extra_specs |                                      |
| Description          | None                                 |
+----------------------+--------------------------------------+


$ manila help create
...
Positional arguments:
  <share_protocol>      Share protocol (NFS, CIFS, CephFS, GlusterFS, HDFS or MAPRFS).
  <size>                Share size in GiB.
Optional arguments:
  --name <name>         Optional share name. (Default=None)
  --share-type <share-type>, --share_type <share-type>, --volume-type <share-type>, --volume_type <share-type>
                        Optional share type. Use of optional volume type is deprecated. (Default=None)

*2$ manila create \
    --name Engineering_share \
    --share-type cephfstype \
    cephfs 1

*$ manila list
+--------------------------------------+-------------------+------+-------------+-----------+-----------+-----------------+-------------------------+-------------------+
| ID                                   | Name              | Size | Share Proto | Status    | Is Public | Share Type Name | Host                    | Availability Zone |
+--------------------------------------+-------------------+------+-------------+-----------+-----------+-----------------+-------------------------+-------------------+
| d73e5318-2145-46e9-8751-e22415e5040d | Engineering_share | 1    | CEPHFS      |`available`| False     | cephfstype      | hostgroup@cephfs#cephfs | nova              |
+--------------------------------------+-------------------+------+-------------+-----------+-----------+-----------------+-------------------------+-------------------+

$ manila help access-allow
...
  <share>               Name or ID of the NAS share to modify.
  <access_type>         Access rule type (only "ip", "user"(user or group), "cert" or "cephx" are supported).
  <access_to>           Value that defines access.
--access-level <access_level>, --access_level <access_level>
                        Share access level ("rw" and "ro" access levels are supported). Defaults to rw.
  
*3$ manila access-allow Engineering_share cephx cloud-user
+--------------+--------------------------------------+
| Property     | Value                                |
+--------------+--------------------------------------+
| access_key   | None                                 |
| share_id     | d73e5318-2145-46e9-8751-e22415e5040d |
| created_at   | 2018-12-06T18:08:14.000000           |
| updated_at   | None                                 |
| access_type  |`cephx`                               |
| access_to    |`cloud-user`                          |
| access_level |`rw`                                  |
| state        | queued_to_apply                      |
| id           | 4197f730-5800-4e9c-8006-3f424dc2ae01 |
+--------------+--------------------------------------+
```

**[root@controller0]**

```bash
# 为 18 题，准备 client.cloud-user 账户
# CLIENT_NAME: client.manila
# entity: client.cloud-user

# ceph --help
...
optional arguments:
  --name CLIENT_NAME, -n CLIENT_NAME                  client name for authentication
 Local commands:
`auth` `get-or-create` <entity> {<caps> [<caps>...]}      add auth info for <entity> from from input file, or random key if no input given, and/or any caps specified in the command

# ceph auth ls
...
client.admin
	key: AQBhMs9bANcVCxAA3ZHYooO3wi1p0hW90kApyw==
	auid: 0
	caps: [mds] allow
	caps: [mgr] allow *
	caps: [mon] allow *
	caps: [osd] allow *
client.cloud-user
	key: `AQDxZQlcpO1oMhAA4MXP/HNkOSuX68KOkMGkXA==``
	caps: [mds] allow rw path=/volumes/_nogroup/9b17b24c-c4a9-4be0-bd97-f6f7a4143eee
	caps: [mon] allow r
	caps: [osd] allow rw pool=manila_data namespace=fsvolumens_9b17b24c-c4a9-4be0-bd97-f6f7a4143eee
`client.manila`
	key: AQAPHM9bAAAAABAACK7Xpz3Px+k3dvbBdq1OlA==
	caps: [mds] allow *
	caps: [mgr] allow *
	caps: [mon] allow r, allow command "auth del", allow command "auth caps", allow command "auth get", allow command "auth get-or-create"
	caps: [osd] allow rw
client.openstack
	key: AQAPHM9bAAAAABAA8DLv19H7QXzX0CnaTql/1w==
	caps: [mds]
	caps: [mgr] allow *
	caps: [mon] profile rbd
	caps: [osd] profile rbd pool=volumes, profile rbd pool=backups, profile rbd pool=vms, profile rbd pool=images, profile rbd pool=metrics

*# ceph auth get-or-create \
    -n client.manila \
    client.cloud-user \
    > cloud-user.keyring

# ls

# cat cloud-user.keyring
```



## 18. 访问共享文件系统 - c5

> 使用以下方法访问 engineering_share 共享文件系统:
>
> 在 Engineering 项目中运行名为 **eng_server1** 的实例，该实例使用以下资源: 
>- [x] image: **web** 
> - [x] flavor: **m1.petitewe** 
> - [x] 安全组: **ssh**与**web** 
> - [x] 秘钥对: **webkey** 
> - [x] cloud-init 数据文件: **manila-data.sh**(该脚本创建eth1网口配置文件，并启用该网口) 
> - [x] 网络: **engnet** 与 **storagenet** 
> - [x] 浮动 IP 分配范围 **172.25.250.101**-**172.25.250.109** 
> 
> - [ ] 在 eng_server1 实例的**/mnt/ceph**上挂载 **engineering_share** 共享 

```bash
# 准备练习环境
# 培训环境，需执行：director.sh/manila-data
# [stack@director]$

cat > manila-data.sh <<EOF
#!/bin/bash
cat > /etc/sysconfig/network-scripts/ifcfg-eth1 <<EOT
DEVICE=eth1
ONBOOT=yes
BOOTPROTO=dhcp
EOT
ifup eth1
curl http://materials/ceph.repo -o /etc/yum.repos.d/ceph.repo
yum -y install ceph-fuse
EOF
```



**[stack@director]**

```bash
*$ source ~/robertrc

# 创建实例
*$ openstack server create \
    --flavor m1.petite \
    --image web \
    --nic net-id=engnet \
    --nic net-id=storagenet \
    --security-group ssh \
    --security-group web \
    --key-name webkey \
    --user-data manila-data.sh \
    --wait \
    eng_server1

# 浮动IP-分配
*$ openstack floating ip create public \
    | grep floating_ip_address
| floating_ip_address | `172.25.250.109` |

# 浮动IP-绑定
*$ openstack server add floating ip \
    eng_server1 172.25.250.109

# 将 cloud-user.keyring 和 ceph.conf 文件从 controller0 拷贝到 eng_server1
*$ scp root@controller0:{/root/cloud-user.keyring,/etc/ceph/ceph.conf} .
cloud-user.keyring									100%   68    85.2KB/s   00:00
ceph.conf														100%  797     1.5MB/s   00:00

*$ scp -i webkey.pem \
    cloud-user.keyring ceph.conf cloud-user@172.25.250.109:
cloud-user.keyring									100%   68   149.0KB/s   00:00
ceph.conf														100%  797     2.0MB/s   00:00

# 查看共享路径
*$ manila show Engineering_share \
    | grep volumes
|| path = 172.24.3.1:6789:`/volumes/_nogroup/9b17b24c-c4a9-4be0-bd97-f6f7a4143eee` |

# 配置eng_server1挂载
*$ ssh -i webkey.pem \
    cloud-user@172.25.250.109
```

**[cloud-user@eng-server1]**

```bash
*$ sudo mkdir /mnt/ceph

$ ceph-fuse -h
usage: ceph-fuse [-n client.username] [-m mon-ip-addr:mon-port] <mount point> [OPTIONS]
  --client_mountpoint/-r <sub_directory>
                    use sub_directory as the mounted root, rather than the full Ceph tree.
...
FUSE options:
  --conf/-c FILE    read configuration from the given configuration file
  --name/-n TYPE.ID set name
  
*$ sudo ceph-fuse \
    --keyring=/home/cloud-user/cloud-user.keyring \
    --conf=/home/cloud-user/ceph.conf \
    --name=client.cloud-user \
    --client-mountpoint=/volumes/_nogroup/9b17b24c-c4a9-4be0-bd97-f6f7a4143eee /mnt/ceph
ceph-fuse[1479]: starting ceph client
2018-12-06 13:37:57.320076 7f6da84ab0c0 -1 init, newargv = 0x5617ce1b8d80 newargc=9
ceph-fuse[1479]: starting fuse
```

```bash
$ df -h | grep ceph
ceph-fuse       `1.0G`     0  1.0G    0% `/mnt/ceph`
```

